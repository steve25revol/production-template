generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider   = "postgresql"
  url        = env("DATABASE_URL")
  extensions = [pgcrypto]
}

model Tenant {
  id        String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name      String   @unique
  slug      String   @unique
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  users     User[]
  auditLogs AuditLog[]
}

model User {
  id           String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  email        String   @unique
  displayName  String
  role         UserRole @default(VIEWER)
  tenantId     String   @db.Uuid
  tenant       Tenant   @relation(fields: [tenantId], references: [id])
  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  auditLogs    AuditLog[]
}

model AuditLog {
  id         String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  action     String
  entity     String
  entityId   String
  changes    Json?
  userId     String   @db.Uuid
  user       User     @relation(fields: [userId], references: [id])
  tenantId   String   @db.Uuid
  tenant     Tenant   @relation(fields: [tenantId], references: [id])
  createdAt  DateTime @default(now())
}

enum UserRole {
  SUPER_ADMIN
  TENANT_ADMIN
  MANAGER
  OPERATOR
  VIEWER
  AUDITOR
}
